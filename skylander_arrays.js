var arrays = {
	"Air": [
		[],
		[
			"LightningRod",
			"SonicBoom",
			"Warnado",
			"Whirlwind"
		],
		[
			"Swarm",
			"JetVac",
			"LightningRodS2",
			"SonicBoomS2",
			"WhirlwindS2",
			"LightCoreJetVac"
		],
		[
			"BoomJet",
			"FreeRanger",
			"PopThorn",
			"Scratch",
			"HornBlastWhirlwind",
			"TurboJetVac",
			"LightCoreWarnado"
		],
		[
			"Gusto",
			"Thunderbolt",
			"Blades",
			"FlingKong",
			"FullBlastJetVac",
			"Breeze",
			"PetVac"
		],
		[
			"HurricaneJetVac",
			"Stormblade"
		],
		[
			"AirStrike",
			"WildStorm",
			"BadJuju"
		]
	],
	"Life": [
		[],
		[
			"Camo",
			"StealthElf",
			"StumpSmash",
			"Zook"
		],
		[
			"TreeRex",
			"Shroomboom",
			"StealthElfS2",
			"StumpSmashS2",
			"ZookS2",
			"LightCoreShroomboom"
		],
		[
			"GrillaDrilla",
			"StinkBomb",
			"BumbleBlast",
			"ZooLou",
			"NinjaStealthElf",
			"ThornHornCamo",
			"LightCoreBumbleBlast"
		],
		[
			"Bushwhack",
			"TuffLuck",
			"FoodFight",
			"HighFive",
			"SureShotShroomboom",
			"Barkley",
			"WhisperElf"
		],
		[
			"SuperShotStealthElf",
			"Thrillipede",
			"TurboChargeDonkeyKong"
		],
		[
			"Ambush",
			"BoomBloom",
			"ChompyMage",
			"CrashBandicoot"
		]
	],
	"Undead": [
		[],
		[
			"ChopChop",
			"Cynder",
			"GhostRoaster",
			"Hex"
		],
		[
			"EyeBrawl",
			"FrightRider",
			"ChopChopS2",
			"CynderS2",
			"HexS2",
			"LightCoreHex"
		],
		[
			"NightShift",
			"RattleShake",
			"GrimCreeper",
			"RollerBrawl",
			"TwinBladeChopChop",
			"PhantomCynder",
			"LightCoreGrimCreeper"
		],
		[
			"KryptKing",
			"ShortCut",
			"BatSpin",
			"FunnyBone",
			"EyeSmall",
			"Hijinx"
		],
		[
			"BoneBashRollerBrawl",
			"Fiesta"
		],
		[
			"Chopscotch",
			"PitBoss",
			"Wolfgang"
		]
	],
	"Earth": [
		[],
		[
			"Bash",
			"DinoRang",
			"PrismBreak",
			"Terrafin"
		],
		[
			"Crusher",
			"Flashwing",
			"BashS2",
			"PrismBreakS2",
			"TerrafinS2",
			"LightCorePrismBreak"
		],
		[
			"DoomStone",
			"RubbleRouser",
			"Scorp",
			"SlobberTooth",
			"HyperBeamPrismBreak",
			"KnockoutTerrafin",
			"LightCoreFlashwing"
		],
		[
			"HeadRush",
			"Wallop",
			"FistBump",
			"RockyRoll",
			"Bop",
			"Terrabite"
		],
		[
			"SharkShooterTerrafin",
			"SmashHit"
		],
		[
			"Barbella",
			"TriTip",
			"GoldenQueen"
		]
	],
	"Fire": [
		[],
		[
			"Eruptor",
			"Flameslinger",
			"Ignitor",
			"Sunburn"
		],
		[
			"HotHead",
			"HotDog",
			"EruptorS2",
			"FlameslingerS2",
			"IgnitorS2",
			"LightCoreEruptor"
		],
		[
			"BlastZone",
			"FireKraken",
			"Fryno",
			"Smolderdash",
			"LavaBarfEruptor",
			"FireBoneHotDog",
			"LightCoreSmolderdash"
		],
		[
			"KaBoom",
			"Wildfire",
			"Torch",
			"TrailBlazer",
			"HogWildFryno",
			"Weeruptor",
			"SmallFry"
		],
		[
			"HammerSlamBowser",
			"LavaLanceEruptor",
			"Spitfire"
		],
		[
			"Ember",
			"FlareWolf",
			"TaeKwonCrow"
		]
	],
	"Water": [
		[],
		[
			"GillGrunt",
			"SlamBam",
			"WhamShell",
			"Zap"
		],
		[
			"Thumpback",
			"Chill",
			"GillGruntS2",
			"SlamBamS2",
			"ZapS2",
			"LightCoreChill"
		],
		[
			"FreezeBlade",
			"WashBuckler",
			"PunkShock",
			"RipTide",
			"AnchorsAwayGillGrunt",
			"BlizzardChill",
			"LightCoreWhamShell"
		],
		[
			"LobStar",
			"SnapShot",
			"Echo",
			"FlipWreck",
			"TidalWaveGillGrunt",
			"GillRunt",
			"Thumpling"
		],
		[
			"DeepDiveGillGrunt",
			"DiveClops"
		],
		[
			"KingPen",
			"Tidepool",
			"GraveClobber"
		]
	],
	"Magic": [
		[],
		[
			"DoubleTrouble",
			"Spyro",
			"WreckingBall",
			"Voodood"
		],
		[
			"Ninjini",
			"PopFizz",
			"DoubleTrouble15",
			"DoubleTroubleS2",
			"SpyroS2",
			"WreckingBallS2",
			"LightCorePopFizz"
		],
		[
			"TrapShadow",
			"HootLoop",
			"DuneBug",
			"StarStrike",
			"MegaRamSpyro",
			"SuperGulpPopFizz",
			"LightCoreStarStrike"
		],
		[
			"Blastermind",
			"Enigma",
			"CobraCadabra",
			"DejaVu",
			"FizzyFrenzyPopFizz",
			"MiniJini",
			"Spry"
		],
		[
			"BigBubblePopFizz",
			"Splat"
		],
		[
			"Buckshot",
			"Mysticat",
			"PainYatta"
		]
	],
	"Tech": [
		[],
		[
			"Boomer",
			"DrillSergeant",
			"Drobot",
			"TriggerHappy"
		],
		[
			"Bouncer",
			"Sprocket",
			"DrillSergeantS2",
			"DrobotS2",
			"TriggerHappyS2",
			"LightCoreDrobot"
		],
		[
			"MagnaCharge",
			"SpyRise",
			"WindUp",
			"Countdown",
			"BigBangTriggerHappy",
			"HeavyDutySprocket",
			"LightCoreCountdown"
		],
		[
			"Gearshift",
			"JawBreaker",
			"Chopper",
			"TreadHead",
			"Drobit",
			"TriggerSnappy"

		],
		[
			"DoubleDareTriggerHappy",
			"HighVolt"
		],
		[
			"ChainReaction",
			"RoBow",
			"DrKrankcase",
			"DrNeoCortex"
		]
	],
	"Light": [
		[],
		[],
		[],
		[],
		[
			"KnightLight",
			"Spotlight"
		],
		[
			"Astroblast"
		],
		[
			"Aurora",
			"BlasterTron"
		]
	],
	"Dark": [
		[],
		[],
		[],
		[],
		[
			"KnightMare",
			"Blackout"
		],
		[
			"Nightfall"
		],
		[
			"Starcast",
			"HoodSickle",
			"Kaos"
		]
	],

	"Games": [
		"SpyrosAdventure",
		"Giants",
		"SwapForce",
		"TrapTeam",
		"Superchargers",
		"SuperchargersRacing",
		"Imaginators",
		"Universe",
		"CloudPatrol",
		"LostIslands",
		"Battlegrounds",
		"Battlecast",
		"RingOfHeroes"
	],
	"Types": [
		"Air",
		"Life",
		"Undead",
		"Earth",
		"Fire",
		"Water",
		"Magic",
		"Tech",
		"Light",
		"Dark",
		"KaosElement"
	],
	"AdventurePacks": [
		"EmpireOfIce",
		"PirateSeas",
		"DarklightCrypt",
		"DragonsPeak",
		"TowerOfTime",
		"SheepWreckIsland",
		"NightmareExpress",
		"MirrorOfMystery",
		"SunscraperSpire",
		"MidnightMuseum",
		"GryphonParkObservatory",
		"EnchantedElvenForest"
	],
	"MagicItems": [
		"AnvilRain",
		"SkyIronShield",
		"HiddenTreasure",
		"GhostSwords",
		"TimeTwister",
		"HealingElixir",
		"WingedBoots",
		"SparxDragonfly",
		"VolcanicVault",
		"Cannon",
		"GoldenCannon",
		"Catapult",
		"PlatinumTreasureChest",
		"BattleHammer",
		"SkyDiamond",
		"PlatinumSheep",
		"GrooveMachine",
		"ArkeyanCrossbow",
		"FieryForge",
		"PiggyBank",
		"HandOfFate",
		"LegendaryHandOfFate",
		"RocketRam",
		"TikiSpeaky",
		"LandTrophy",
		"SkyTrophy",
		"SeaTrophy",
		"KaosTrophy",
		"BronzeMysteryChest",
		"SilverMysteryChest",
		"GoldMysteryChest",
		"BlueChest"
	],

	"Traps": [
		"Air",
		"Life",
		"Undead",
		"Earth",
		"Fire",
		"Water",
		"Magic",
		"Tech",
		"Light",
		"Dark",
		"KaosElement"
	],
	"AirTraps": [
		"AirHourglassTrap",
		"AirJugheadTrap",
		"AirScreamerTrap",
		"AirSnakeTrap",
		"AirSwordTrap",
		"AirToucanTrap"
	],
	"LifeTraps": [
		"LifeHammerTrap",
		"LifeSnakeTrap",
		"LifeSwordTrap",
		"LifeTorchTrap",
		"LifeToucanTrap",
		"LifeYawnTrap"
	],
	"UndeadTraps": [
		"LegendaryUndeadOrbTrap",
		"LegendaryUndeadSkullTrap",
		"UndeadAxeTrap",
		"UndeadCaptainsHatTrap",
		"UndeadHandTrap",
		"UndeadOrbTrap",
		"UndeadSkullTrap",
		"UndeadSnakeTrap"
	],
	"EarthTraps": [
		"EasterBunnyEarthTrap",
		"EarthHammerTrap",
		"EarthHandstandTrap",
		"EarthHourglassTrap",
		"EarthOrbTrap",
		"EarthTotemTrap",
		"EarthToucanTrap"
	],
	"FireTraps": [
		"FireCaptainsHatTrap",
		"FireScepterTrap",
		"FireScreamerTrap",
		"FireTorchTrap",
		"FireTotemTrap",
		"FireYawnTrap"
	],
	"WaterTraps": [
		"LegendaryWaterJugheadTrap",
		"WaterAngelTrap",
		"WaterAxeTrap",
		"WaterFlyingHelmetTrap",
		"WaterJugheadTrap",
		"WaterLogHolderTrap",
		"WaterTikiTrap"
	],
	"MagicTraps": [
		"MagicAxeTrap",
		"MagicHourglassTrap",
		"MagicLogHolderTrap",
		"MagicRocketTrap",
		"MagicSkullTrap",
		"MagicTotemTrap"
	],
	"TechTraps": [
		"TechAngelTrap",
		"TechFlyingHelmetTrap",
		"TechHandstandTrap",
		"TechHandTrap",
		"TechScepterTrap",
		"TechTikiTrap"
	],
	"LightTraps": [
		"LightHawkTrap",
		"LightRocketTrap",
		"LightYawnTrap"
	],
	"DarkTraps": [
		"DarkHandstandTrap",
		"DarkSpiderTrap",
		"DarkSwordTrap"
	],
	"KaosTraps": [
		"UltimateKaosTrap",
		"KaosTrap"
	],

	"Villains": [
		"Air",
		"Life",
		"Undead",
		"Earth",
		"Fire",
		"Water",
		"Magic",
		"Tech",
		"Light",
		"Dark",
		"KaosElement"
	],
	"AirVillains": [
		"Dreamcatcher",
		"BadJujuVillain",
		"BuzzerBeak",
		"Krankenstein"
	],
	"LifeVillains": [
		"ChompyMageVillain",
		"BroccoliGuy",
		"SteamedBroccoliGuy",
		"Chompy",
		"CuckooClocker",
		"SheepCreep",
		"ShieldShredder",
		"RiotShieldShredder",
	],
	"UndeadVillains": [
		"WolfgangVillain",
		"BoneChompy",
		"HoodSickleVillain",
		"MaskerMind"
	],
	"EarthVillains": [
		"GoldenQueenVillain",
		"ChompChest",
		"GraveClobberVillain",
		"TussleSprout",
		"RedHotTussleSprout"
	],
	"FireVillains": [
		"ChefPepperJack",
		"Grinnade",
		"ScrapShooter",
		"SmokeScream"
	],
	"WaterVillains": [
		"Gulper",
		"BrawlAndChain",
		"RebelBrawlAndChain",
		"ChillBill",
		"CrossCrow",
		"SlobberTrap",
		"ThreatPack"
	],
	"MagicVillains": [
		"PainyattaVillain",
		"BombShell",
		"RageMage"
	],
	"TechVillains": [
		"DrKrankcaseVillain",
		"Brawlrus",
		"BruiserCruiser",
		"MadLobs",
		"Shrednaught",
		"SteampunkShrednaught",
		"TrollingThunder"
	],
	"LightVillains": [
		"Luminous",
		"BlasterTronVillain",
		"EyeFive",
		"LobGoblin",
		"RebelLobGoblin"
	],
	"DarkVillains": [
		"Nightshade",
		"EyeScream",
		"Fisticuffs",
		"TaeKwonCrowVillain"
	],
	"KaosVillains": [
		"KaosVillain"
	],

	"Crystals": [
		"Air",
		"Life",
		"Undead",
		"Earth",
		"Fire",
		"Water",
		"Magic",
		"Tech",
		"Light",
		"Dark"
	],
	"AirCrystals": [
		"AirAcornCreationCrystal",
		"AirAngelCreationCrystal",
		"AirLanternCreationCrystal"
	],
	"LifeCrystals": [
		"LegendaryLifeAcornCreationCrystal",
		"LifeAcornCreationCrystal",
		"LifeClawCreationCrystal",
		"LifeRocketCreationCrystal",
		"LifeRuneCreationCrystal"
	],
	"UndeadCrystals": [
		"UndeadClawCreationCrystal",
		"UndeadFangedCreationCrystal",
		"UndeadLanternCreationCrystal"
	],
	"EarthCrystals": [
		"EarthArmorCreationCrystal",
		"EarthRocketCreationCrystal",
		"EarthRuneCreationCrystal"
	],
	"FireCrystals": [
		"FireAcornCreationCrystal",
		"FireAngelCreationCrystal",
		"FireReactorCreationCrystal"
	],
	"WaterCrystals": [
		"WaterArmorCreationCrystal",
		"WaterFangedCreationCrystal",
		"WaterRocketCreationCrystal"
	],
	"MagicCrystals": [
		"LegendaryMagicLanternCreationCrystal",
		"MagicClawCreationCrystal",
		"MagicLanternCreationCrystal",
		"MagicPyramidCreationCrystal"
	],
	"TechCrystals": [
		"TechArmorCreationCrystal",
		"TechPyramidCreationCrystal",
		"TechReactorCreationCrystal"
	],
	"LightCrystals": [
		"LegendaryLightFangedCreationCrystal",
		"LightAngelCreationCrystal",
		"LightFangedCreationCrystal",
		"LightRuneCreationCrystal"
	],
	"DarkCrystals": [
		"DarkPyramidCreationCrystal",
		"DarkReactorCreationCrystal",
		"DarkRuneCreationCrystal"
	],

	"LandVehicles": [
		"CryptCrusher",
		"TombBuggy",
		"SharkTank",
		"ThumpTruck",
		"BurnCycle",
		"HotStreak",
		"DarkHotStreak",
		"GoldenHotStreak",
		"E3HotStreak",
		"BarrelBlaster",
		"DarkBarrelBlaster",
		"GoldRusher",
		"PowerBlueGoldRusher",
		"ShieldStriker"
	],
	"SkyVehicles": [
		"ClownCruiser",
		"DarkClownCruiser",
		"JetStream",
		"SkySlicer",
		"BuzzWing",
		"StealthStinger",
		"NitroStealthStinger",
		"SunRunner",
		"LegendarySunRunner"
	],
	"SeaVehicles": [
		"DiveBomber",
		"SpringAheadDiveBomber",
		"ReefRipper",
		"SodaSkimmer",
		"NitroSodaSkimmer",
		"SplatterSplasher",
		"PowerBlueSplatterSplasher",
		"SeaShadow",
		"DarkSeaShadow"
	],
	"Minis": [
		"Breeze",
		"PetVac",
		"PowerPunchPetVac",
		"SidekickBarkley",
		"Barkley",
		"GnarlyBarkley",
		"SidekickWhisperElf",
		"WhisperElf",
		"SidekickEyeSmall",
		"EyeSmall",
		"Hijinx",
		"Bop",
		"Weeruptor",
		"EggsellentWeeruptor",
		"SmallFry",
		"SidekickTerraBite",
		"Terrabite",
		"SidekickGillRunt",
		"GillRunt",
		"SidekickThumpling",
		"Thumpling",
		"SidekickMiniJini",
		"MiniJini",
		"Spry",
		"Drobit",
		"SidekickTriggerSnappy",
		"TriggerSnappy"
	],
	"LightCores": [
		"LightCoreJetVac",
		"LightCoreWarnado",
		"LightCoreShroomBoom",
		"LightCoreBumbleBlast",
		"LightCoreHex",
		"LightCoreGrimCreeper",
		"LightCorePrismBreak",
		"LightCoreFlashwing",
		"LightCoreEruptor",
		"LightCoreSmolderdash",
		"LightCoreChill",
		"LightCoreWhamShell",
		"LightCorePopFizz",
		"LightCoreStarStrike",
		"LightCoreDrobot",
		"LightCoreCountdown"
	],
	"Elites": [
		"EonsEliteWhirlwind",
		"EonsEliteStealthElf",
		"EonsEliteZook",
		"EonsEliteChopChop",
		"EonsEliteGhostRoaster",
		"EonsEliteTerrafin",
		"EonsEliteDinoRang",
		"EonsEliteEruptor",
		"EonsEliteGillGrunt",
		"EonsEliteSlamBam",
		"EonsEliteSpyro",
		"EonsEliteVoodood",
		"EonsEliteTriggerHappy",
		"EonsEliteBoomer"
	],

	"Variants": [
		"Air",
		"Life",
		"Undead",
		"Earth",
		"Fire",
		"Water",
		"Magic",
		"Tech",
		"Light",
		"Dark"
	],
	"AirVariants": [
		"LegendaryJetVac",
		"PolarWhirlwind",
		"LegendaryFreeRanger",
		"LegendaryBlades",
		"PowerPunchPetVac",
		"LegendaryHurricaneJetVac",
		"EggBomberAirStrike",
		"MysticalBadJuju"
	],
	"LifeVariants": [
		"GnarlyTreeRex",
		"LegendaryStealthElf",
		"JollyBumbleBlast",
		"LegendaryZooLou",
		"DarkStealthElf",
		"LegendaryBushwhack",
		"DarkFoodFight",
		"GnarlyBarkley",
		"DarkSuperShotStealthElf",
		"EggcitedThrillipede",
		"DarkTurboChargeDonkeyKong",
		"JingleBellChompyMage"
	],
	"UndeadVariants": [
		"LegendaryChopChop",
		"LegendaryNightShift",
		"QuickdrawRattleShake",
		"LegendaryLightCoreGrimCreeper",
		"NitroKryptKing",
		"LegendaryBoneBashRollerBrawl",
		"FrightfulFiesta",
		"CandyCoatedChopscotch",
		"LegendaryPitBoss",
		"DarkWolfgang"
	],
	"EarthVariants": [
		"LegendaryBash",
		"GraniteCrusher",
		"JadeFlashwing",
		"DarkSlobberTooth",
		"NitroHeadRush",
		"SteelPlatedSmashHit",
		"LegendaryTriTip",
		"DarkGoldenQueen"
	],
	"FireVariants": [
		"MoltenHotDog",
		"LegendaryIgnitor",
		"DarkBlastZone",
		"JadeFireKraken",
		"VolcanicEruptor",
		"DarkWildFire",
		"EggsellentWeeruptor",
		"DarkHammerSlamBowser",
		"DarkSpitfire",
		"HardBoiledFlareWolf",
		"MysticalTaeKwonCrow"
	],
	"WaterVariants": [
		"LegendarySlamBam",
		"LegendaryLightCoreChill",
		"NitroFreezeBlade",
		"DarkWashBuckler",
		"WinterfestLobStar",
		"DarkSnapShot",
		"MissileTowDiveClops",
		"DarkKingPen",
	],
	"MagicVariants": [
		"DarkSpyro",
		"LegendarySpyro",
		"ScarletNinjini",
		"RoyalDoubleTrouble",
		"PunchPopFizz",
		"EnchantedHootLoop",
		"DarkMegaRamSpyro",
		"EnchantedLightCoreStarStrike",
		"KingCobraCadabra",
		"LegendaryDejaVu",
		"LovePotionPopFizz",
		"BirthdayBashBigBubblePopFizz",
		"PowerBlueSplat",
	],
	"TechVariants": [
		"LegendaryTriggerHappy",
		"LegendaryBouncer",
		"NitroMagnaCharge",
		"KickoffCountdown",
		"SpringtimeTriggerHappy",
		"LegendaryJawbreaker",
		"PowerBlueTriggerHappy",
	],
	"LightVariants": [
		"LegendaryAstroblast",
		"SolarFlareAurora"
	],
	"DarkVariants": [
		"SteelPlatedHoodSickle"

	],
}

var rev_map = {}
var type_count_array = ["Air", "Life", "Undead", "Earth", "Fire", "Water", "Magic", "Tech", "Light", "Dark"]
for(var type in type_count_array) {
	let gens = arrays[type_count_array[type]];
	for(let i=1; i<gens.length; i++) {
		for(let mon in gens[i]) {
			if(!rev_map[gens[i][mon]])
				rev_map[gens[i][mon]] = [];
			rev_map[gens[i][mon]].push(type_count_array[type])
		}
	}
}

var MODE = {
	SITE: 2,
	STRICT: 1,
	STANDARD: 2,
	SILLY: 3
}
function addToArray(key, category, gen, fs, spliceInfo) {
	let add_to = arrays[category];
	if(typeof gen == "number" || typeof gen == "string") {
		add_to = arrays[category][gen];
	}else if(gen !== null) {
		for(let g in gen) {
			addToArray(key, category, gen[g], fs, spliceInfo);
		}
		return;
	}
	if(add_to.includes(key))
		return;
	if(spliceInfo) {
		let newindex = add_to.indexOf(spliceInfo.after);
		if(newindex >= 0) {
			newindex++;
			if(add_to[newindex] == spliceInfo.after + "_female")
				newindex++;
			if(!spliceInfo.dontroll && !spliceInfo.after.match(/_/)) {
				while(add_to[newindex] && add_to[newindex].match(spliceInfo.after)) {
					newindex++;
				}
			}
		}
		if(spliceInfo.before) {
			let alt_index = add_to.indexOf(spliceInfo.before);
			if(alt_index >= 0) {
				newindex = alt_index;
			}
		}
		if(newindex >= 0) {
			add_to.splice(newindex, 0, key);
			if(fs && MODE.SITE >= MODE.SILLY)
				add_to.splice(newindex+1, 0, key+"_female");
			return;
		}
	}
	add_to.push(key);
	if(fs && MODE.SITE >= MODE.SILLY)
		add_to.push(key+"_female");
}
function remodeArrays() {
	let temp = type_count_array.concat(["Gimmick", "Legendary", "Starter"]);
	for(let t in temp) {
		arrays[temp[t]] = [];
		for(let i=0; i<10; i++) {
			arrays[temp[t]].push([]);
		}
	}
	arrays.Mythical = [];
	let form_order = {
		regional: [],
		regional2: [],
		mega: [],
		gmax: [],
		paradox: [],
		gimmick: [],
		other: [],
		spam: []
	}
	let mechanical = ["mega", "gmax"];
	let other_gimmick = ["regional", "regional2", "paradox", "gimmick", "pokestar"];
	let all_gimmicks = mechanical.concat(other_gimmick);
	/*
	Hierarchy
		New Pokemon. Minor forms can appear here if nondisruptive
		Regional Variants.
		Mechanical forms
		Spam forms
	*/
	for(let p in pokedex) {
		// handle base form
		let mon = pokedex[p];
		if(MODE.SITE == MODE.STRICT && mon.kind == "pokestar")
			continue;
		let debut = mon.gen;
		let types = mon.types;
		if(mon.kind == "spam") {
			form_order.spam.push([p, ""]);
		}
		else if(mon.kind == "pokestar") {
			form_order.gimmick.push([p, ""]);
		}
		else{
			for(let t in mon.types) {
				addToArray(p, types[t], debut, mon.fs, mon.splice);
			}
			// convergent Gimmick
			if(mon.kind == "convergent") {
				// always debut Gimmick
				addToArray(p, "Gimmick", debut, mon.fs, mon.splice);
				// in silly mode, also inspiration Gimmick
				if(MODE.SITE >= MODE.SILLY) {
					addToArray(p, "Gimmick", mon.insp, mon.fs, mon.splice);
				}
			}
			// dupe paradox to form order for gimmick column and type backadding
			if(mon.kind == "paradox" && MODE.SITE >= MODE.SURPLUS)
				form_order.paradox.push([p, ""]);
			// legendary column
			if(mon.hasOwnProperty("ls")) {
				addToArray(p, "Legendary", debut, mon.fs, mon.splice);
				if(mon.ls == 2) {
					addToArray(p, "Mythical", null, mon.fs, mon.splice);
				}
			}
		}
		// prepare subforms
		for(let f in mon.forms) {
			let thisForm = mon.forms[f];
			let launch = thisForm.gen || debut;
			types = thisForm.types || types;
			switch(thisForm.kind) {
				// regional, mega, and gmax go to form handling later
				case "regional":
				case "regional2":
				case "mega":
				case "gmax":
				case "gimmick":
					form_order[thisForm.kind].push([p, f]);
					break;
				// same-gen major and minor forms go in arrays now
				// later-gen go to form handling later
				// minor are ignored on strict mode
				case "minor":
					if(MODE.SITE == MODE.STRICT)
						break;
				case "major":
					// if surplus mode or same gen debut, put in base's array
					if(launch == debut || MODE.SITE >= MODE.SURPLUS) {
						// always add after the mon
						for(let t in types) {
							addToArray(p+"_"+f, types[t], debut, thisForm.fs, thisForm.splice);
						}
						// Legendary
						if(mon.hasOwnProperty("ls")) {
							addToArray(p+"_"+f, "Legendary", debut, thisForm.fs, thisForm.splice);
							if(mon.ls == 2) {
								addToArray(p+"_"+f, "Mythical", null, thisForm.fs, thisForm.splice);
							}
						}
					}
					// if not same gen debut, put in other array of form handler
					if(launch != debut)
						form_order.other.push([p, f]);
					break;
				case "silly":
					// eg Genesect, Sinistea; only used on Silly Mode
					if(MODE.SITE < MODE.SILLY)
						break;
				case "extra":
					// eg Arceus, Silvally; only used on Surplus and Silly
					if(MODE.SITE < MODE.SURPLUS)
						break;
				case "spam":
				case "pokestar":
					// eg Unown, Vivillon. Skipped on Strict
					if(MODE.SITE < MODE.STANDARD)
						break;
				default:
					if(thisForm.kind == "pokestar") {
						form_order.gimmick.push([p, f]);
					}
					else if(thisForm.kind == "spam") {
						form_order.spam.push([p, f]);
					}
					else{
						form_order.other.push([p, f]);
					}
					break;
			}
		}
	}
	// now seed in forms
	for(let kind in form_order) {
		for(let pairIndex in form_order[kind]) {
			let [baseKey, formKey] = form_order[kind][pairIndex];
			let base_mon = pokedex[baseKey];
			let form_data = base_mon;
			if(base_mon.forms && base_mon.forms[formKey])
				form_data = base_mon.forms[formKey];
			let debut = base_mon.gen;
			if(form_data.kind == "paradox")
				debut = base_mon.insp;
			let launch = form_data.gen || debut;
			let types = form_data.types || base_mon.types;
			let sprite = baseKey;
			if(formKey != "")
				sprite += "_" + formKey;
			let spliceInfo = form_data.splice || {}
			if(!spliceInfo.after && mechanical.includes(form_data.kind))
				spliceInfo.after = baseKey;
			/*
				Mega, GMax
					Types: Launch (+debut at Surplus)
					Gimmick: Debut (+launch at Surplus)
				Regional, Gimmick (ex shadow lugia)
					Types: Launch (+debut at Surplus)
					Gimmick: Launch (+debut at Surplus)
				other
					Types: Launch (+debut at Surplus)
			*/
			// types always go in Launch
			// also in base debut if different and Surplus+
			// gimmick forms don't go to types in Strict
			let gens_to_add = [];
			if(MODE.SITE > MODE.STRICT) {
				// outside of strict mode, add to launch types
				gens_to_add.push(launch);
			}
			else if(!all_gimmicks.includes(kind)) {
				// add non-gimmick forms to launch types in strict mode
				gens_to_add.push(launch);
			}
			if(form_data.kind == "paradox") {
				// add to inspiration generation in silly mode
				if(MODE.SITE >= MODE.SILLY)
					gens_to_add.push(base_mon.insp);
			}
			else if(MODE.SITE >= MODE.SURPLUS) {
				// add other kinds to debut types in surplus Mode
				gens_to_add.push(debut);
			}
			if(gens_to_add.length > 0) {
				for(let t in types) {
					addToArray(sprite, types[t], gens_to_add, form_data.fs, spliceInfo);
				}
				// Legendary column / Mythical box
				if(base_mon.hasOwnProperty("ls")) {
					addToArray(sprite, "Legendary", gens_to_add, form_data.fs, spliceInfo);
					if(base_mon.ls == 2)
						addToArray(sprite, "Mythical", null, form_data.fs, spliceInfo);
				}
			}
			// Gimmick
			// goes in Debut if Mega, Gmax, or SURPLUS+ Regional, Gimmick
			if(mechanical.includes(kind) || (other_gimmick.includes(kind) && MODE.SITE != MODE.STANDARD)) {
				addToArray(sprite, "Gimmick", debut, form_data.fs, spliceInfo);
			}
			// goes in Launch if Regional, Gimmick, Gen6Mega, or SURPLUS+ Mega, Gmax
			if(other_gimmick.includes(kind) || (mechanical.includes(kind) && MODE.SITE != MODE.STANDARD) || kind == "mega") {
				addToArray(sprite, "Gimmick", launch, form_data.fs, spliceInfo);
			}
		}
	}
	
	// other arrays
	/*
		Bird, Critter, Bug contains first form
		+ last in Surplus
		+ middle in Silly
		Psuedo contains last form
		+ first in Surplus
		+ middle in Silly
		Pikaclone cuts the minor forms in Serious
	*/
	let alterable_arrays = ["Bird", "Critter", "RegionalBug", "Pseudo", "Pikaclone"];
	let categoryMap = {
		Bird: {
			"PIDGEY": 1,
			"PIDGEOTTO": 4,
			"PIDGEOT": 3,
			"PIDGEOT_1": 4,
			"SPEAROW": 1,
			"FEAROW": 3,
			"HOOTHOOT": 1,
			"NOCTOWL": 3,
			"TAILLOW": 1,
			"SWELLOW": 3,
			"WINGULL": 1,
			"PELIPPER": 3,
			"STARLY": 1,
			"STARAVIA": 4,
			"STARAPTOR": 3,
			"PIDOVE": 1,
			"TRANQUILL": 4,
			"UNFEZANT": 3,
			"UNFEZANT_1": 3,
			"FLETCHLING": 1,
			"FLETCHINDER": 4,
			"TALONFLAME": 3,
			"PIKIPEK": 1,
			"TRUMBEAK": 4,
			"TOUCANNON": 3,
			"ROOKIDEE": 1,
			"CORVISQUIRE": 4,
			"CORVIKNIGHT": 3,
			"SQUAWKABILLY": 1,
			"WATTREL": 1,
			"KILOWATTREL": 3
		},
		Critter: {
			"RATTATA": 1,
			"RATICATE": 3,
			"SENTRET": 1,
			"FURRET": 3,
			"ZIGZAGOON": 1,
			"LINOONE": 3,
			"BIDOOF": 1,
			"BIBAREL": 3,
			"PATRAT": 1,
			"WATCHOG": 3,
			"BUNNELBY": 1,
			"DIGGERSBY": 3,
			"YUNGOOS": 1,
			"GUMSHOOS": 3,
			"RATTATA_1": 1,
			"RATICATE_1": 3,
			"SKWOVET": 1,
			"GREEDENT": 3,
			"ZIGZAGOON_1": 1,
			"LINOONE_1": 3,
			"OBSTAGOON": 3,
			"LECHONK": 1,
			"OINKOLOGNE": 3,
			"OINKOLOGNE_1": 3
		},
		RegionalBug: {
			"CATERPIE": 1,
			"METAPOD": 4,
			"BUTTERFREE": 3,
			"BUTTERFREE_1": 3,
			"WEEDLE": 1,
			"KAKUNA": 4,
			"BEEDRILL": 3,
			"BEEDRILL_1": 3,
			"LEDYBA": 1,
			"LEDIAN": 3,
			"SPINARAK": 1,
			"ARIADOS": 3,
			"WURMPLE": 1,
			"SILCOON": 4, 
			"BEAUTIFLY": 3,
			"CASCOON": 4, 
			"DUSTOX": 3,
			"KRICKETOT": 1,
			"KRICKETUNE": 3,
			"SEWADDLE": 1,
			"SWADLOON": 4,
			"LEAVANNY": 3,
			"VENIPEDE": 1,
			"WHIRLIPEDE": 4,
			"SCOLIPEDE": 3,
			"SCATTERBUG": 1,
			"SPEWPA": 4,
			"VIVILLON": 3,
			"GRUBBIN": 1,
			"CHARJABUG": 4,
			"VIKAVOLT": 3,
			"BLIPBUG": 1,
			"DOTTLER": 4,
			"ORBEETLE": 3,
			"ORBEETLE_1": 3,
			"SNOM": 3,
			"FROSMOTH": 4,
			"TAROUNTULA": 1,
			"SPIDOPS": 3,
			"NYMBLE": 1,
			"LOKIX": 3
			
		},
		Pseudo: {
			"DRATINI": 3,
			"DRAGONAIR": 4,
			"DRAGONITE": 1,
			"LARVITAR": 3,
			"PUPITAR": 4,
			"TYRANITAR": 1,
			"BAGON": 3,
			"SHELGON": 4,
			"SALAMENCE": 1,
			"BELDUM": 3,
			"METANG": 4,
			"METAGROSS": 1,
			"GIBLE": 3,
			"GABITE": 4,
			"GARCHOMP": 1,
			"DEINO": 3,
			"ZWEILOUS": 4,
			"HYDREIGON": 1,
			"GOOMY": 3,
			"SLIGGOO": 4,
			"GOODRA": 1,
			"JANGMOO": 3,
			"HAKAMOO": 4,
			"KOMMOO": 1,
			"DREEPY": 3,
			"DRAKLOAK": 4,
			"DRAGAPULT": 1,
			"SLIGGOO_1": 4,
			"GOODRA_1": 1,
			"FRIGIBAX": 3,
			"ARCTIBAX": 4,
			"BAXCALIBUR": 1,
			"DURALUDON": 4,
			"ARCHALUDON": 3,
			"TYRANITAR_1": 1,
			"SALAMENCE_1": 1,
			"METAGROSS_1": 1,
			"GARCHOMP_1": 1,
		},
		Pikaclone: {
			"PICHU": 1,
			"PICHU_1": 2,
			"PICHU_2": 2,
			"PIKACHU": 1,
			"RAICHU": 1,
			"RAICHU_1": 1,
			"PIKACHU_70": 1,
			"PLUSLE": 1,
			"MINUN": 1,
			"PACHIRISU": 1,
			"EMOLGA": 1,
			"DEDENNE": 1,
			"TOGEDEMARU": 1,
			"MIMIKYU": 1,
			"MIMIKYU_1": 2,
			"MORPEKO": 1,
			"MORPEKO_1": 1,
			"PAWMI": 1,
			"PAWMO": 1,
			"PAWMOT": 1,
			"PIKACHU_2": 2,
			"PIKACHU_3": 2,
			"PIKACHU_4": 2,
			"PIKACHU_5": 2,
			"PIKACHU_6": 2,
			"PIKACHU_7": 2,
			"PIKACHU_8": 2,
			"PIKACHU_9": 2,
			"PIKACHU_10": 2,
			"PIKACHU_11": 2,
			"PIKACHU_12": 2,
			"PIKACHU_13": 2,
			"PIKACHU_14": 2,
			"PIKACHU_15": 2
		}
	}
	for(let i in alterable_arrays) {
		let a = alterable_arrays[i];
		arrays[a] = [];
		for(let k in categoryMap[a]) {
			if(MODE.SITE >= categoryMap[a][k]) {
				arrays[a].push(k);
				if(MODE.SITE == MODE.SILLY && keyToMonData(k).is_fs) {
					arrays[a].push(k+"_female");
				}
			}
		}
	}
	
	for(let g in arrays.Starter) {
		let pull_from = starterLayout[g];
		for(let p in pull_from) {
			let check = pull_from[p];
			if(typeof check == "string") {
				let mon_data = keyToMonData(check);
				addToArray(check, "Starter", g, mon_data.form_data.fs, mon_data.form_data.splice);
			}
			else if(MODE.SITE >= check[1]) {
				let mon_data = keyToMonData(check[0]);
				addToArray(check[0], "Starter", g, mon_data.form_data.fs, mon_data.form_data.splice)
			}
		}
	}
	// hsneasel female
	let sneasel = arrays.Regional.indexOf("SNEASEL_1");
	let ladySneasel = arrays.Regional.indexOf("SNEASEL_1_female");
	if(ladySneasel >= 0 && MODE.SITE < MODE.SILLY) {
		arrays.Regional.splice(ladySneasel, 1);
	}
	else if(MODE.SITE >= MODE.SILLY) {
		arrays.Regional.splice(sneasel, 1, "SNEASEL_1_female");
	}
}
let starterLayout = [
	[],
	[
		"BULBASAUR",
		"IVYSAUR",
		"VENUSAUR",
		["VENUSAUR_1", 4],
		["VENUSAUR_2", 4],
		"CHARMANDER",
		"CHARMELEON",
		"CHARIZARD",
		["CHARIZARD_1", 4],
		["CHARIZARD_2", 4],
		["CHARIZARD_3", 4],
		"SQUIRTLE",
		"WARTORTLE",
		"BLASTOISE",
		["BLASTOISE_1", 4],
		["BLASTOISE_2", 4],
		["RATTATA", 4],
		"PIKACHU",
		["PIKACHU_70", 4],
		// XD
		"EEVEE",
		["EEVEE_1", 4],
		["VAPOREON", 4],
		["JOLTEON", 4],
		["FLAREON", 4]
	],
	[
		"CHIKORITA",
		"BAYLEEF",
		"MEGANIUM",
		"CYNDAQUIL",
		"QUILAVA",
		"TYPHLOSION",
		// PLA backadd
		["TYPHLOSION_1", 4],
		"TOTODILE",
		"CROCONAW",
		"FERALIGATR",
		// Ranger backadd
		["PICHU_2", 4],
		// Colo backadd
		["ESPEON", 4],
		["UMBREON", 4]
	],
	[
		"TREECKO",
		"GROVYLE",
		"SCEPTILE",
		["SCEPTILE_1", 4],
		"TORCHIC",
		"COMBUSKEN",
		"BLAZIKEN",
		["BLAZIKEN_1", 4],
		"MUDKIP",
		"MARSHTOMP",
		"SWAMPERT",
		["SWAMPERT_1", 4],
		// XD
		["EEVEE", 3],
		["VAPOREON", 4],
		["JOLTEON", 4],
		["FLAREON", 4],
		// Colo
		["ESPEON", 3],
		["UMBREON", 3],
		// Ranger
		["PLUSLE", 3],
		["MINUN", 3],
		// FRLG
		["BULBASAUR", 4],
		["IVYSAUR", 4],
		["VENUSAUR", 4],
		["CHARMANDER", 4],
		["CHARMELEON", 4],
		["CHARIZARD", 4],
		["SQUIRTLE", 4],
		["WARTORTLE", 4],
		["BLASTOISE", 4]
	],
	[
		"TURTWIG",
		"GROTLE",
		"TORTERRA",
		"CHIMCHAR",
		"MONFERNO",
		"INFERNAPE",
		"PIPLUP",
		"PRINPLUP",
		"EMPOLEON",
		// Ranger
		["STARLY", 3],
		["PACHIRISU", 3],
		["MUNCHLAX", 3],
		["PICHU_2", 3],
		// Rumble
		["RATTATA", 3],
		// HGSS
		["CHIKORITA", 4],
		["BAYLEEF", 4],
		["MEGANIUM", 4],
		["CYNDAQUIL", 4],
		["QUILAVA", 4],
		["TYPHLOSION", 4],
		["TOTODILE", 4],
		["CROCONAW", 4],
		["FERALIGATR", 4]
	],
	[
		"SNIVY",
		"SERVINE",
		"SERPERIOR",
		"TEPIG",
		"PIGNITE",
		"EMBOAR",
		"OSHAWOTT",
		"DEWOTT",
		"SAMUROTT",
		// PLA back add
		["SAMUROTT_1", 4]
	],
	[
		"CHESPIN",
		"QUILLADIN",
		"CHESNAUGHT",
		"FENNEKIN",
		"BRAIXEN",
		"DELPHOX",
		"FROAKIE",
		"FROGADIER",
		"GRENINJA",
		["GRENINJA_2", 3],
		// Megas
		["VENUSAUR_1", 3],
		["CHARIZARD_1", 3],
		["CHARIZARD_2", 3],
		["BLASTOISE_1", 3],
		// oras
		["TREECKO", 4],
		["GROVYLE", 4],
		["SCEPTILE", 4],
		["SCEPTILE_1", 3],
		["TORCHIC", 4],
		["COMBUSKEN", 4],
		["BLAZIKEN", 4],
		["BLAZIKEN_1", 3],
		["MUDKIP", 4],
		["MARSHTOMP", 4],
		["SWAMPERT", 4],
		["SWAMPERT_1", 3]
	],
	[
		"ROWLET",
		"DARTRIX",
		"DECIDUEYE",
		["DECIDUEYE_1", 4],
		"LITTEN",
		"TORRACAT",
		"INCINEROAR",
		"POPPLIO",
		"BRIONNE",
		"PRIMARINA",
		// LGPE
		["PIKACHU", 3],
		["PIKACHU_70", 4],
		["EEVEE", 3],
		["EEVEE_1", 4],
		["GRENINJA_2", 3],
	],
	[
		"GROOKEY",
		"THWACKEY",
		"RILLABOOM",
		["RILLABOOM_1", 2],
		"SCORBUNNY",
		"RABOOT",
		"CINDERACE",
		["CINDERACE_1", 2],
		"SOBBLE",
		"DRIZZILE",
		"INTELEON",
		["INTELEON_1", 2],
		// PLA backadd
		["ROWLET", 3],
		["DARTRIX", 3],
		"DECIDUEYE_1",
		["CYNDAQUIL", 3],
		["QUILAVA", 3],
		"TYPHLOSION_1",
		["OSHAWOTT", 3],
		["DEWOTT", 3],
		"SAMUROTT_1",
		// other gmax
		["VENUSAUR_2", 3],
		["CHARIZARD_3", 3],
		["BLASTOISE_2", 3],
		["PIKACHU_70", 3],
		["EEVEE_1", 3],
		//BDSP
		["TURTWIG", 4],
		["GROTLE", 4],
		["TORTERRA", 4],
		["CHIMCHAR", 4],
		["MONFERNO", 4],
		["INFERNAPE", 4],
		["PIPLUP", 4],
		["PRINPLUP", 4],
		["EMPOLEON", 4]
	],
	[
		"SPRIGATITO",
		"FLORAGATO",
		"MEOWSCARADA",
		"FUECOCO",
		"CROCALOR",
		"SKELEDIRGE",
		"QUAXLY",
		"QUAXWELL",
		"QUAQUAVAL",
		// ZA
		["CHIKORITA", 3],
		["BAYLEEF", 3],
		["MEGANIUM", 3],
		"MEGANIUM_1",
		["TEPIG", 3],
		["PIGNITE", 3],
		["EMBOAR", 3],
		"EMBOAR_1",
		["TOTODILE", 3],
		["CROCONAW", 3],
		["FERALIGATR", 3],
		"FERALIGATR_1"
		// 
	]
]
let starterMap = {
	Kanto: [
		{gen: 1, mode: MODE.STRICT, tag: "Red/Blue"},
		{gen: 3, mode: MODE.SILLY, tag: "FireRed/LeafGreen"}
	],
	Kanto_Mega: [
		{gen: 1, mode: MODE.SILLY, tag: "XY"},
		{gen: 6, mode: MODE.SURPLUS, tag: "XY"}
	],
	Kanto_Gmax: [
		{gen: 1, mode: MODE.SILLY, tag: "Sword/Shield"},
		{gen: 8, mode: MODE.SURPLUS, tag: "Sword/Shield"}
	],
	Johto: [
		{gen: 2, mode: MODE.STRICT, tag: "Gold/Silver/Crystal"},
		{gen: 4, mode: MODE.SILLY, tag: "HeartGold/SoulSilver"}
	],
	Hoenn: [
		{gen: 3, mode: MODE.STRICT, tag: "Ruby/Sapphire/Emerald"},
		{gen: 6, mode: MODE.SILLY, tag: "OmegaRuby/AlphaSapphire"}
	],
	Hoenn_Mega: [
		{gen: 3, mode: MODE.SILLY, tag: "OmegaRuby/AlphaSapphire"},
		{gen: 6, mode: MODE.SURPLUS, tag: "OmegaRuby/AlphaSapphire"}
	],
	Sinnoh: [
		{gen: 4, mode: MODE.STRICT, tag: "Diamond/Pearl/Platinum"},
		{gen: 8, mode: MODE.SILLY, tag: "BrilliantDiamond/ShiningPearl"}
	],
	Unova: [
		{gen: 5, mode: MODE.STRICT, tag: "Black/White"}
	],
	Kalos: [
		{gen: 6, mode: MODE.STRICT, tag: "XY"}
	],
	Alola: [
		{gen: 7, mode: MODE.STRICT, tag: "Sun/Moon"}
	],
	Pikachu: [
		{gen: 1, mode: MODE.STRICT, tag: "Yellow/Let's Go"},
		{gen: 7, mode: MODE.SURPLUS, tag: "Let's Go Pikachu"}
	],
	Pikachu_Gmax: [
		{gen: 1, mode: MODE.SILLY, tag: "Sword/Shield"},
		{gen: 7, mode: MODE.SILLY, tag: "Sword/Shield"},
		{gen: 8, mode: MODE.SURPLUS, tag: "Sword/Shield"}
	],
	Eevee: [
		{gen: 1, mode: MODE.STRICT, tag: "Let's Go Eevee"},
		{gen: 3, mode: MODE.SURPLUS, tag: "XD: Gale of Darkness"},
		{gen: 7, mode: MODE.SURPLUS, tag: "Let's Go Eevee"}
	],
	Eevee_Gmax: [
		{gen: 1, mode: MODE.SILLY, tag: "Sword/Shield"},
		{gen: 7, mode: MODE.SILLY, tag: "Sword/Shield"},
		{gen: 8, mode: MODE.SURPLUS, tag: "Sword/Shield"}
	],
	Eeveelution: [
		{gen: 1, mode: MODE.SILLY, tag: "XD: Gale of Darkness"},
		{gen: 3, mode: MODE.SILLY, tag: "XD: Gale of Darkness"}
	],
	Orre: [
		{gen: 2, mode: MODE.SILLY, tag: "Colosseum/XD"},
		{gen: 3, mode: MODE.SURPLUS, tag: "Colosseum/XD"},
	],
	Galar: [
		{gen: 8, mode: MODE.STRICT, tag: "Sword/Shield"}
	],
	Paldea: [
		{gen: 9, mode: MODE.STRICT, tag: "Scarlet/Violet"}
	],
	Hisui: [
		{gen: 8, mode: MODE.STRICT, tag: "Legends Arceus"}
	],
	Lumiose: [
		{gen: 9, mode: MODE.STRICT, tag: "Legends Z-A"}
	],
	Hisui_prevo: [
		{gen: 8, mode: MODE.SURPLUS, tag: "Legends Arceus"}
	],
	Lumiose_prevo: [
		{gen: 9, mode: MODE.SURPLUS, tag: "Legends Z-A"}
	],
	Rumble: [
		{gen: 1, mode: MODE.SILLY, tag:"Pokemon Rumble"},
		{gen: 4, mode: MODE.SURPLUS, tag:"Pokemon Rumble"}
	],
	Ranger: [
		{gen: 3, mode: MODE.SURPLUS, tag:"Pokemon Ranger"}
	],
	Ranger2: [
		{gen: 4, mode: MODE.SURPLUS, tag:"Pokemon Ranger: Shadows of Almia"}
	],
	Ranger3: [
		{gen: 2, mode: MODE.SILLY, tag:"Pokemon Ranger: Guardian Signs"},
		{gen: 4, mode: MODE.SURPLUS, tag:"Pokemon Ranger: Guardian Signs"}
	]
}
let starterSideMap = {
	"mega": {6: "XY/ORAS", 9:"Legends Z-A"},
	"gmax": {8: "Sword/Shield"}
}
function resolveStarterSlots(form_data) {
	let slots = [];
	if(form_data.starters) {
		slots = form_data.starters;
	}
	else if(form_data.starter) {
		slots = [form_data.starter];
	}
	if(!slots.length)
		return [];
	let active_slots = [];
	for(let s in slots) {
		let table = slots[s];
		if(starterMap[table])
			table = starterMap[table];
		for(let t in table) {
			if(table[t].mode > MODE.SITE)
				continue;
			active_slots.push(table[t]);
		}
	}
	return active_slots;
}
function starterGame(mon_key, gen) {
	let mon_data = keyToMonData(mon_key);
	let form_data = mon_data.form_data;
	if(starterSideMap[form_data.kind] && starterSideMap[form_data.kind][form_data.gen])
		return starterSideMap[form_data.kind][form_data.gen];
	let slots = resolveStarterSlots(mon_data.form_data);
	if(slots.length == 0)
		return "";
	for(let s in slots) {
		if(slots[s].gen == gen) {
			return slots[s].tag;
		}
	}
	return slots[0].tag;
}
function updateMode() {
	let msel = document.getElementById("mode-select");
	let newmode = Number(msel.value);
	if(MODE.SITE == newmode)
		return;
	MODE.SITE = newmode;
	remodeArrays();
	
	let nextURL = new URL(location);
	nextURL.searchParams.delete("mode");
	if(MODE.SITE != MODE.STANDARD)
		nextURL.searchParams.set("mode", MODE.SITE);
	var nextTitle = "Ultimate Favorite Pokemon Picker";
	var nextState = { additionalInformation: 'Updated the mode parameter' };
	//document.getElementById("new_url").innerHTML = nextURL;
	//document.getElementById("new_url").href = nextURL;
	try{
		window.history.replaceState(nextState, nextTitle, nextURL);
	}catch(e){
		// unclear when this does and doesn't work
	}
}
function keyToMonData(k) {
	let splitter = k.match(/^([^_]+)(_(\d+))?(_female)?$/);
	let base = splitter[1];
	let form_n = splitter[3] || "";
	let is_fs = !!splitter[4];
	let mon = pokedex[splitter[1]];
	if(!mon)
		return keyToNonMonData(k);
	let form_data = mon;
	if(mon.forms && mon.forms[form_n])
		form_data = mon.forms[form_n];
	return {mon:mon, base_key:splitter[1], form_key:form_n, form_data:form_data, is_fs:is_fs};
}
function keyToNonMonData(k) {
	let longName = k.replace(/(.)([A-Z])/g, "$1 $2");
	let nom = {
		name: longName,
		gen: 0,
		num: 0
	}
	return {mon:nom, base_key:k, form_key:"", form_data:nom, is_fs:false}
}
function alcremieTooltip(k, has_toppings) {
	let splitter = k.match(/^([^_]+)(_(\d+))?(_female)?$/);
	let form_n = splitter[3] || "0";
	let num = Number(form_n);
	let flavor_index = Math.floor(num/7);
	let flavors = ["Vanilla Cream", "Ruby Cream", "Matcha Cream", "Mint Cream", "Lemon Cream", "Salted Cream", "Ruby Swirl", "Caramel Swirl", "Rainbow Swirl"];
	if(!has_toppings)
		return flavors[flavor_index] + " Alcremie";
	let topping_index = num%7;
	let toppings = ["Strawberry", "Berry", "Love", "Star", "Clover", "Flower", "Ribbon"];
	return flavors[flavor_index] + " Alcremie with " + toppings[topping_index] + " Sweets";
}

// jumbled up to avoid the random noise generating nasty words
var _64encode = [
	"0",
	"d","w","2","z","9","j","4","3",
	"7","M","p","q","v","x","6","b",
	"f","c","r","t","h","k","s","5",
	"g","m","8","l","1",".","_",
	
	"R",
	"D","W","T","Z","J","H","L","K",
	"n","N","P","Q","V","X","y","B",
	"F","C","e","S","u","o","E","i",
	"a","A","I","G","O","U","Y",
	"-","~"
];
var _64_NEXT_MON = _64encode[64];
var _64_NEXT_FORM = _64encode[65];
var _64_UPPERCASE = 32;
var _64_STR_RGX = new RegExp(`(${_64_NEXT_MON}{3,20}|${_64_NEXT_FORM}{3,20})`, 'g')
/*
A Pokemon is encoded by converting their dex number to ~2 digit base 64
that is, base 64 but capped at 2048 instead of 4096
this allows us to "capitalize" the first digit to denote it's using an extra form
who's key is added as a third digit. this is often but not always a literal capital, but it doesn't matter
Sneasel -> wg
Hisuian Sneasel -> WEt
_70s use _0 instead
Alcremie has one safe form left lmao

We can shortcut the next mon with - and the next form with ~
wgWEt	-> Sneasel and HSneasel in 5 characters 
wg~		-> condensed to 3
wgw5	-> Sneasel and Teddiursa in 4 characters
wg-		-> condensed to 3

If these chain 3 or more, encode them as x~/x-
0t0d0w0z090j	-> Bulbasaur-Charizard in 12 characters
0t-----			-> in 7
0t9-			-> in 4
0j0jt0jd0jw		-> Charizard, X, Y, GMax in 11
0j~~~			-> in 5
0jw~			-> in 4
Wm8~			-> all 28 unowns in 4
If this overflows, just chain them
0tY-Z-			-> the first 100 pokemon
0tY-Y-Y-n-6~F-	-> Bulbasaur-Unown-UnownZ-Celebi
For now limiting this at 20 because its not super relevant and is a wildcard for making nasty words

A Form character can never be -/~, so we can assign special cases to those instead
-0 would add the next 0 pokemon
	instead we add another character to define a special sprite
	Wg-dt -> Gold Sneasel sprite
	this is doesn't have a way to be encoded atm
~0 would add the next 0 forms
	instead we turn the pokemon into its female Form
	Wg~0 -> Female Sneasel
~t would add the next 1 form, which is worse than just ~
	instead we add another character, and use the female Form of that Form
	Wg~tt -> Female Hisuian Sneasel, the only one that uses this rn
~d would add the next 2, which is redundant with ~~
	this is unused but reserved for form overflow
	VH~dt -> Alcremie_64
-t and -d is unused
~~, --, ~-, -~ are unused

~ can be used as the first character to open a settings section
within that section, ~ is reserved as section terminator, - as parameter terminator
ex ~title-Favorite%20Dog%20Pokemon~
these parts should be compressed when possible though
ex ~Fav_Dog_Mon-g20~
g20 mapping to gen: [2, 0] or, use Gold sprites
and title expanding common words and swapping spaces to _, saving two URL characters each
assume its always there and save two characters ~- closes it if you really need it

A full line might look like
~Fav_Bat_Mon~0M-dMwc45lc-pn-q5~QRd
Zubat line, Gligar line, Woobat line, Noibat line, Lunala forms
even with two cross gen evos and the third Lunala form needing QRd instead of ~
the list gets a compression of 1.75 characters/mon which is lovely
*/
function arrayEncoder(ar) {
	let prev_mon, prev_form;
	let str = "";
	let lastPart = "";
	let controlLine = ["", 0];
	let endControlLine = false;
	for(let a in ar) {
		let mon_data = keyToMonData(ar[a]);
		str += partEncoder(mon_data.base_key, mon_data.form_key, prev_mon, prev_form, mon_data.is_fs);
		prev_mon = mon_data.base_key;
		prev_form = mon_data.form_key;
	}
	str = str.replace(_64_STR_RGX, function(_1) {
		return _64encode[_1.length] + _1[0];
	})
	return str;

/*	{
		if(part == _64_NEXT_MON) {
			if(controlLine[0] == "") {
				// see if it's worth starting
				let start_control_line = true;
				if(lastPart == "")
					start_control_line = false;
				if(lastPart.length > 2)
					start_control_line = false;
				if(start_control_line)
					controlLine = [part, 1];
			}
			else if(controlLine[0] == part) {
				controlLine[0] = part;
				controlLine[1]++;
			}
			else{
				endControlLine = true;
			}
			if(a == ar.length-1 && controlLine[1] > 0)
				endControlLine = true;
		}
		else if(controlLine[1] > 0) {
			endControlLine = true;
		}
		if(endControlLine) {
			let firstInd = _64encode.indexOf(lastPart[0]);
			if(firstInd >= _64_UPPERCASE) {
				// already a form
				// only bother at 5+
				if(controlLine[1] >= 5) {
					lastPart = lastPart.substring(0, 2) + controlLine[0] + controlLine[0] + lastPart[2] + _64encode[controlLine[1]]
				}
				else{
					for(let i=0; i<controlLine[1]; i++)
						lastPart += controlLine[0];
				}
			}else if(controlLine[1] > 2) {
				// at 3 this is useful
				lastPart = _64encode[firstInd+_64_UPPERCASE] + lastPart.substring(1);
				if(controlLine[0] == _64_NEXT_MON && controlLine[1] > 63) {
					lastPart += controlLine[0];
					while(controlLine[1] > 63) {
						lastPart += _64encode[0];
						controlLine[1] -= 63;
					}
					lastPart += _64encode[controlLine[1]];
				}else{
					lastPart += controlLine[0] + _64encode[controlLine[1]];
				}
			}else{
				// otherwise just do ~~ and let ~1 and ~2 do special things
				for(let i=0; i<controlLine[1]; i++)
					lastPart += controlLine[0];
			}
			controlLine = ["", 0];
			str += lastPart;
			if(part == _64_NEXT_MON || part == _64_NEXT_FORM) {
				if(a != ar.length-1) {
					str += part;
				}
				lastPart = "";
			}else{
				lastPart = part;
			}
		}
		else if(controlLine[1] == 0) {
			// normal string, add lastPart and cache this one
			str += lastPart;
			lastPart = part;
		}
	}
	if(lastPart)
		str += lastPart;
	*/
}
function partEncoder(mon_key, form_key, prev_mon, prev_form, female) {
	let mon = pokedex[mon_key];
	if(!mon)
		return "";
	let prev = pokedex[prev_mon];
	if(prev && mon.num == prev.num+1 && (form_key == "") && !female) {
		// shortcut with next_mon
		return _64_NEXT_MON;
	}
	if(prev && mon.num == prev.num && mon.forms && !female) {
		// can we shortcut with next form?
		let formKeys = Object.keys(mon.forms);
		let thisInd = formKeys.indexOf(form_key);
		let prevInd = formKeys.indexOf(prev_form);
		if(thisInd == prevInd+1) {
			return _64_NEXT_FORM;
		}
	}
	// convert to base 64-ish
	let second = mon.num%64;
	let first = (mon.num-second)/64;
	if(form_key != "" || female) {
		first += _64_UPPERCASE;
	}
	let core = String(_64encode[first]) + String(_64encode[second]);
	if(form_key != "") {
		let form_n = Number(form_key);
		if(form_n >= 64)
			form_n = 0;
		if(female)
			core += _64_NEXT_FORM + String(_64encode[1]);
		core += String(_64encode[form_n]);
	}
	else if(female) {
		core += _64_NEXT_FORM + String(_64encode[0]);
	}
	return core;
}
function stringDecoder(fullstring) {
	let mons = [];
	for(let c=0; c<fullstring.length; c++) {
		let last_num, last_form;
		if(mons.length) {
			[last_num, last_form] = mons[mons.length-1];
		}
		if(!last_form)
			last_form = 0;
		switch(fullstring[c]) {
			case _64_NEXT_MON:
				mons.push([last_num+1, 0]);
				break;
			case _64_NEXT_FORM:
				mons.push([last_num, Number(last_form)+1]);
				break;
			default:
				let first = fullstring[c];
				c++;
				let second = fullstring[c];
				let formChar = "";
				let female = false;
				let dnm = _64encode.indexOf(second);
				let add = _64encode.indexOf(first);
				let num = dnm + (64*add);
				let group_add_mons = 0;
				let group_add_forms = 0;
				let sprite = "";
				if(second == _64_NEXT_MON) {
					// special x- case, iterate x -
					for(let i=1; i<=add; i++) {
						mons.push([last_num+i, last_form]);
					}
					break;
				}
				if(second == _64_NEXT_FORM) {
					// special x~ case, iterate x ~
					for(let i=1; i<=add; i++) {
						mons.push([last_num, Number(last_form)+i]);
					}
					break;
				}
				if(add >= _64_UPPERCASE) {
					add -= _64_UPPERCASE;
					num = dnm + (64*add);
					c++;
					let thirdChar = fullstring[c];
					
					if(thirdChar == _64_NEXT_FORM) {
						// form controls
						c++;
						let fourthChar = fullstring[c];
						switch(fourthChar) {
							case _64encode[0]:
								// next 0 form is female instead
								female = true;
								break;
							case _64encode[1]:
								// next 1 form is subform female instead
								// consume next character for formChar
								female = true;
								c++;
								formChar = fullstring[c];
								break;
							case _64encode[2]:
								// reserved for > 64 form support
								break;
						}
					}
					else if(thirdChar == _64_NEXT_MON) {
						// adding sprite 
						c++;
						let adding = _64encode.indexOf(fullstring[c]);
						if(adding == 0) {
							// sprite
							c++
							sprite = _64encode.indexOf(fullstring[c]);;
						}
					}
					else{
						// form
						formChar = thirdChar;
					}
				}
				// add the mon here
				let formIndex = _64encode.indexOf(formChar);
				if(formIndex == 0) {
					formIndex = 70;
				}else if(formIndex < 0) {
					formIndex = "";
				}
				mons.push([num, formIndex, female, sprite]);
				for(let i=1; i<=group_add_forms; i++) {
					mons.push([num, Number(formIndex)+i]);
				}
				for(let i=1; i<=group_add_mons; i++) {
					mons.push([num+i, ""]);
				}
				break;
		}
	}
	let nums = {};
	let numKeys = [];
	for(let p in mons) {
		numKeys.push(mons[p][0]);
		let n = String(mons[p][0]);
		if(!nums[n])
			nums[n] = [];
		nums[n].push(p);
	}
	for(let p in pokedex) {
		if(!numKeys.includes(pokedex[p].num))
			continue;
		let nstr = String(pokedex[p].num);
		let mon = pokedex[p];
		for(let i in nums[nstr]) {
			let pairIndex = nums[nstr][i];
			let pair = mons[pairIndex];
			let form_n = String(pair[1]);
			if(form_n == 0 || !mon.forms) {
				// base form
				let sprite = p;
				if(pair[2] && mon.fs)
					sprite += "_female";
				mons.splice(pairIndex, 1, sprite);
			}
			else{
				let form_s = String(form_n);
				if(!mon.forms[form_s]) {
					let form_keys = Object.keys(mon.forms);
					form_s = form_keys[Number(form_s)];
				}
				let sprite = p+"_"+form_s;
				if(!form_s)
					sprite = p;
				if(pair[2] && mon.fs)
					sprite += "_female";
				mons.splice(pairIndex, 1, sprite);
			}
		}
		let index = numKeys.indexOf(mon.num);
		numKeys.splice(index, 1);
		if(numKeys.length == 0)
			break;
	}
	return mons;
}

/*
var fs = require('fs');
var cdex = require('./dex.json');
fs.writeFile("./dex2.json", JSON.stringify(cdex), () => {});
*/